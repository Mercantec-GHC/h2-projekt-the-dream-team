@page "/admin"
@rendermode InteractiveServer
@inherits BasePage

@inject ApiClient Api

<PageTitle>Admin</PageTitle>

<h3 class="mb-4">Værelser</h3>

<!-- Stats Cards -->
<div class="d-flex flex-wrap flex-lg-nowrap gap-4 mb-4">
    <!-- Bookings Card -->
    <div class="w-100">
        <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
                <h5 class="card-title text-muted">Bookings</h5>

                <h2 class="display-4 fw-bold mb-0 mt-1">@(bookings?.Count ?? 0)</h2>

                <a href="/admin/manage-bookings" class="btn btn-primary mt-3 w-100">
                    Se Bookings
                </a>
            </div>
        </div>
    </div>

    <!-- Guests Card -->
    <div class="w-100">
        <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
                <h5 class="card-title text-muted">Gæster</h5>

                <h2 class="display-4 fw-bold mb-0 mt-1">@guestsCount</h2>

                <a href="/admin/manage-guests" class="btn btn-success mt-3 w-100">
                    Se Gæster
                </a>
            </div>
        </div>
    </div>

    <!-- Rooms Card -->
    <div class="w-100">
        <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
                <h5 class="card-title text-muted">Værelser</h5>

                <h2 class="display-4 fw-bold mb-0 mt-1">@(rooms?.Count ?? 0)</h2>

                <a href="/admin/manage-rooms" class="btn btn-info mt-3 w-100">
                    Se Værelser
                </a>
            </div>
        </div>
    </div>

    <!-- Room Types Card -->
    <div class="w-100">
        <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
                <h5 class="card-title text-muted">Værelsestyper</h5>

                <h2 class="display-4 fw-bold mb-0 mt-1">@roomTypesCount</h2>

                <a href="/admin/manage-room-types" class="btn btn-warning mt-3 w-100">
                    Se Værelsestyper
                </a>
            </div>
        </div>
    </div>

    <!-- Room Discounts Card -->
    <div class="w-100">
        <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
                <h5 class="card-title text-muted">Værelsestilbud</h5>

                <h2 class="display-4 fw-bold mb-0 mt-1">@roomDiscountsCount</h2>

                <a href="/admin/manage-room-discounts" class="btn btn-danger mt-3 w-100">
                    Se Værelsestilbud
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Gantt Diagram Section -->
<div class="w-100 card shadow-sm">
    <div class="card-header bg-white">
        <h4 class="mb-0">Booking Overblik</h4>
    </div>

    <div class="card-body p-0 h-diagram d-flex flex-column align-items-center justify-content-center">
        @if (rooms is not null && rooms.Any() && bookings is not null && bookings.Any())
        {
            <BookingOverview Rooms="rooms" Bookings="bookings" />
        }
        else
        {
            <div class="text-muted">
                <i class="bi bi-calendar-x fs-1 mb-3"></i>
                <p class="mb-0">Ingen data tilgængelig.</p>
            </div>
        }
    </div>
</div>

@code {
    private ICollection<BookingDto> bookings;
    private int guestsCount = 0;
    private ICollection<RoomDto> rooms;
    private int roomTypesCount = 0;
    private int roomDiscountsCount = 0;

    protected override async Task OnInitializedAsync()
    {
        bookings = await Api.GetAllBookingsAsync();

        var guests = await Api.GetAllGuestsAsync();

        guestsCount = guests.Count;

        rooms = await Api.GetAllRoomsAsync();

        var roomTypes = await Api.GetAllRoomTypesAsync();

        roomTypesCount = roomTypes.Count;

        var roomDiscounts = await Api.GetAllRoomDiscountsAsync();

        roomDiscountsCount = roomDiscounts.Count;

        StateHasChanged();
    }
}
